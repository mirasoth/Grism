# RFC-0013: Semantic Reasoning & Neurosymbolic Layer

**Status**: Draft
**Authors**: Grism Team
**Last Updated**: 2026-01-21
**Depends on**: RFC-0002, RFC-0003, RFC-0006, RFC-0012
**Supersedes**: —

---

## 1. Abstract

This RFC defines the **Semantic Reasoning & Neurosymbolic Layer** of Hypergraph.

This layer enables:

* Symbolic reasoning over graph-structured knowledge
* Ontology-aware inference
* Rule-based derivation of new facts
* Integration of neural signals (embeddings, scores, LLM outputs)

Crucially, semantic reasoning is **explicit, inspectable, and optional**.
No inference may silently alter query semantics or storage truth.

This RFC defines how *meaning is computed*, not merely retrieved.

---

## 2. Scope and Non-Goals

### 2.1 Scope

This RFC specifies:

* Semantic entities and vocabularies
* Rule and inference model
* Ontology and constraint integration
* Neurosymbolic primitives
* Execution and materialization semantics
* Safety, explainability, and isolation rules

### 2.2 Non-Goals

This RFC does **not** define:

* Natural language query interfaces
* LLM prompting strategies
* Autonomous agents or planning
* Training or fine-tuning of neural models
* Truth maintenance under contradictory updates

---

## 3. Design Principles

1. **Semantics Are Explicit**
   Inference MUST be opt-in and visible.

2. **Truth Is Layered**
   Derived facts never overwrite stored facts.

3. **Symbolic First, Neural Assisted**
   Neural signals guide reasoning; they do not define truth.

4. **Monotonic by Default**
   Reasoning MUST NOT retract base facts unless explicitly allowed.

---

## 4. Semantic Layer Overview

The semantic layer operates **above storage** and **alongside execution**.

It consumes:

* Persisted Hypergraphs (RFC-0012)
* Expressions and plans (RFC-0003, RFC-0006)

It produces:

* Derived facts
* Inference traces
* Semantic annotations

---

## 5. Semantic Data Model

### 5.1 Semantic Assertions

A **semantic assertion** is represented as a derived hyperedge:

```
Hyperedge {
  id: EdgeId,
  label: "ASSERTION",
  roles: {
    subject → EntityRef,
    predicate → EntityRef,
    object → EntityRef,
    provenance → EntityRef
  },
  properties: {
    confidence: Float,
    timestamp: Timestamp
  }
}
```

Assertions MAY refer to:

* Nodes
* Hyperedges
* Literal values
* Abstract concepts

Assertions are immutable once produced and stored as hyperedges.

---

### 5.2 Provenance

Every derived assertion MUST include provenance:

* Source facts
* Rule identifiers
* Confidence (optional)
* Timestamp / snapshot

Provenance is mandatory and queryable.

---

## 6. Ontology & Vocabulary

### 6.1 Ontology Model

Ontologies define:

* Concept hierarchies
* Role constraints
* Domain / range rules
* Equivalence and subsumption

Ontologies MAY be expressed using:

* OWL-like fragments
* Custom Horn-style rules

---

### 6.2 Ontology Binding

Ontologies are bound to Hypergraphs via:

* Labels
* Roles
* Property schemas

Bindings MUST be explicit and versioned.

---

## 7. Rule System

### 7.1 Rule Definition

Rules are expressed as **Horn clauses** that derive new hyperedges:

```
IF hypergraph_pattern AND constraints
THEN derived_hyperedge
```

Rules MAY reference:

* Hypergraph patterns using Expand semantics
* Properties and roles
* Existing assertion hyperedges
* Expressions (RFC-0003)
* Vector similarity predicates

---

### 7.2 Rule Safety

Rules MUST be:

* Range-restricted
* Finite in application
* Deterministic unless explicitly declared otherwise

Unsafe rules MUST be rejected at validation time.

---

## 8. Reasoning Modes

### 8.1 Query-Time Reasoning

Inference occurs during query execution.

Properties:

* No persistence
* Snapshot-consistent
* Bounded by query scope

Used for:

* Type inference
* Constraint checking
* Semantic filtering

---

### 8.2 Materialized Reasoning

Inference results are persisted as derived hyperedges in Lance datasets.

Properties:

* Explicit materialization step
* Stored in separate Lance dataset (e.g., derived_hyperedges.lance)
* Versioned and inspectable
* Rebuildable from base data and rules

Materialized facts MUST be marked as derived with provenance hyperedges.

---

## 9. Neurosymbolic Integration

### 9.1 Neural Signals

Neural inputs MAY include:

* Embedding similarity scores
* Classifier outputs
* LLM-generated annotations

Neural signals are **advisory**, not authoritative.

---

### 9.2 Neural Guards

Neural outputs MUST:

* Be thresholded
* Be explainable
* Never directly assert facts

All neural-derived assertions MUST be mediated by symbolic rules.

---

## 10. Execution Semantics

### 10.1 Reasoning as Operators

Reasoning is executed via explicit operators:

* `Infer`
* `Validate`
* `Annotate`

These operators appear in logical and physical plans.

---

### 10.2 Interaction with Planning

* Reasoning operators participate in rewrite rules (RFC-0006)
* Cost estimation applies (RFC-0007)
* Execution modes apply (RFC-0008, RFC-0010)

Reasoning MUST NOT:

* Alter operator semantics
* Bypass access path rules
* Violate snapshot isolation

---

## 11. Consistency & Soundness

### 11.1 Soundness

All derived facts MUST be logically entailed by:

* Base facts
* Ontologies
* Rules
* Declared neural assumptions

Unsound inference is forbidden.

---

### 11.2 Incompleteness

The system MAY be incomplete:

* Not all entailed facts need be derived
* Performance bounds take precedence

Incompleteness MUST be documented.

---

## 12. Explainability & Auditing

The system MUST support:

* Explanation of any derived fact
* Rule trace inspection
* Neural signal contribution breakdown
* Confidence propagation

Explainability is **mandatory**, not optional.

---

## 13. Error Handling

Semantic errors include:

| Error             | Meaning                       |
| ----------------- | ----------------------------- |
| OntologyViolation | Constraint breach             |
| UnsafeRule        | Non-terminating or unbounded  |
| NeuralLeakage     | Neural fact asserted directly |
| InferenceOverflow | Reasoning exceeded bounds     |

Errors MUST surface clearly and early.

---

## 14. Relationship to Other RFCs

* **RFC-0002**: Graph semantics underlie patterns
* **RFC-0003**: Expressions used in rules
* **RFC-0006**: Reasoning operators rewrite-safe
* **RFC-0012**: Derived facts persist here
* **RFC-0014**: Agents & planning (future)

RFC-0013 defines **how meaning emerges**.

---

## 15. Open Questions

* Non-monotonic reasoning
* Probabilistic logic integration
* Incremental reasoning on updates
* Trust calibration for neural signals

---

## 16. Conclusion

This RFC defines the **semantic conscience** of Hypergraph.

> **Data answers questions.
> Logic explains answers.
> Semantics explains why the answers matter—through explicit hyperedge-based reasoning.**
