---
date: 2026-01-22
session: physical-planning-spec-polish
objective: Polish specs/6_physical_planning_impl.md for production-ready local execution engine implementation
status: completed
---

## Objective

Polish the physical planning implementation spec to be fully consistent with related RFCs and current implementations, making it production-ready for implementing the local execution engine.

## Completed

- Completely rewrote `specs/6_physical_planning_impl.md` (471 → 2396 lines)
- Aligned all naming conventions with RFC-namings (`*Exec` suffix pattern)
- Aligned physical operator interface with RFC-0008 normative spec
- Changed data model from row-based `HashMap<String, Value>` to Arrow `RecordBatch`
- Added explicit `PhysicalPlan` and `PhysicalPlanner` abstractions
- Defined complete operator set matching `grism-logical` LogicalOp variants
- Added `ExecutionContext` with storage, memory, metrics per RFC-0008
- Defined concrete module layout for `grism-engine` rewrite
- Added RFC-0010 extension points (Exchange, partitioning) as placeholders
- Included comprehensive testing strategy and acceptance checklist

## Files Changed

| File | Change |
|------|--------|
| `specs/6_physical_planning_impl.md` | Complete rewrite - production-ready implementation spec |

## Key Design Decisions

1. **Arrow-native data flow**: All operators use `RecordBatch`, not custom row types
2. **PhysicalPlanner abstraction**: Explicit `LocalPhysicalPlanner` converts LogicalPlan → PhysicalPlan
3. **Operator naming**: All physical operators follow `*Exec` pattern (e.g., `NodeScanExec`, `FilterExec`)
4. **Pull-based execution**: Operators implement `async fn next() -> Option<RecordBatch>`
5. **ExecutionContext**: Contains storage handle, memory manager, metrics sink, cancellation token
6. **Complete operator mapping**: All LogicalOp variants have corresponding physical operators

## RFC Compliance

- RFC-0006: Logical plan structure referenced correctly
- RFC-0007: Cost model and execution mode concepts incorporated
- RFC-0008: Primary normative spec - operator lifecycle, data model aligned
- RFC-0009: Index/adjacency access path concepts for expand operators
- RFC-0010: Extension points defined but not implemented
- RFC-namings: All type/operator names follow canonical conventions

## Tests

N/A - This was a specification document update, not code changes.

## Notes

- The spec explicitly marks Week 7 scope vs Week 8 (distributed) scope
- `grism-engine` can be fully rewritten without backward compatibility concerns
- Storage integration needs `RecordBatch` conversion layer (storage currently returns entity objects)
- Expression evaluation will reuse `grism-logical` types

## Next Steps

1. Implement `PhysicalPlan` and `PhysicalSchema` types
2. Implement `PhysicalOperator` trait and base operator implementations
3. Implement `LocalPhysicalPlanner`
4. Implement `LocalExecutor` with Arrow RecordBatch pipeline
5. Add storage-to-Arrow conversion for scan operators
