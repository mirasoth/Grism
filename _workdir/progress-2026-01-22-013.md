---
date: 2026-01-22
session: engine-runtime-separation-spec
objective: Update bridge design spec for engine-runtime separation architecture
status: completed
---

## Objective

Update `specs/8_bridge_distributed_impl.md` to define the architecture for separating common engine components from runtime-specific implementations, enabling both local and Ray-based distributed execution.

## Completed

1. **Reviewed existing specifications**
   - Read `specs/7_local_engine_milestone.md` for current local engine architecture
   - Read `specs/8_bridge_distributed_impl.md` for existing distributed bridge design
   - Reviewed `specs/rfc-0010.md` for distributed execution model
   - Reviewed `specs/rfc-namings.md` for naming conventions

2. **Updated `specs/8_bridge_distributed_impl.md`** with:
   - New three-crate architecture diagram
   - `grism-engine`: Common physical layer (operators, expressions, schemas, traits)
   - `grism-local`: Local runtime (in-memory and Lance storage support)
   - `grism-ray`: Distributed runtime on Ray (renamed from `grism-distributed`)
   - Defined `ExecutionContextTrait` for runtime abstraction
   - Detailed Exchange operator and stage splitting for Ray
   - Added migration path from current structure
   - Implementation checklist for phased migration
   - API compatibility examples showing unchanged local execution API

## Files Changed

| File | Description |
|------|-------------|
| `specs/8_bridge_distributed_impl.md` | Complete rewrite with engine-runtime separation architecture |

## Tests

```
make test
All 335 tests passed (90 grism-core, 97 grism-engine, 91 grism-logical, 46 grism-optimizer, 5 grism-storage, plus doc tests)
```

## Lint

```
make lint
0 warnings, 0 errors - PASSED
```

## Notes

### Architecture Summary

The new design separates concerns into three crates:

1. **grism-engine (Common)**
   - `PhysicalPlan`, `PhysicalOperator` trait
   - All operator implementations (`*Exec`)
   - `ExprEvaluator` for expression evaluation
   - Schema inference
   - `OperatorCaps` for capability declarations
   - Memory and metrics traits

2. **grism-local (Local Runtime)**
   - `LocalExecutor` - pull-based single-machine execution
   - `LocalPhysicalPlanner` - no Exchange operators
   - `LocalExecutionContext` - implements `ExecutionContextTrait`
   - Support for `InMemoryStorage` and `LanceStorage`

3. **grism-ray (Distributed Runtime)**
   - `RayExecutor` - stage-based distributed execution
   - `DistributedPlanner` - Exchange insertion, stage splitting
   - `ExchangeExec` operator for data repartitioning
   - Ray task management and Arrow IPC transport

### Key Design Decisions

- **Zero semantic drift**: Local and distributed execution must produce identical results
- **Explicit distribution**: Exchange operators are visible in plans (no hidden shuffles)
- **Backward compatibility**: Current local execution API remains unchanged
- **Stage-based execution**: Stages are the only unit of distribution

## Next Steps

1. Extract common traits (`ExecutionContextTrait`, `PhysicalPlanner`) from grism-engine
2. Create `grism-local` crate with moved components
3. Rename `grism-distributed` to `grism-ray`
4. Implement Exchange operator and stage splitting in grism-ray
